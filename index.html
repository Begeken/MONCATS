<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MonCats Web App</title>
</head>
<body>
    <h1>Welcome to MonCats!</h1>
    <p>Click below to start mining:</p>
    <button id="startMining">Start Mining</button>

    <script>
    document.addEventListener("DOMContentLoaded", async function () {
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('user_id');

        if (!userId) {
            alert("User ID not found!");
            return;
        }

        const startButton = document.getElementById("startMining");

        async function checkMining() {
            let response = await fetch(`http://127.0.0.1:5000/check_mining?user_id=${userId}`);
            let data = await response.json();

            if (data.success && data.remaining_time > 0) {
                startButton.innerText = `Mining in progress... ⏳ ${Math.floor(data.remaining_time / 3600)}h`;
                startButton.disabled = true;
            } else {
                startButton.innerText = "Start Mining";
                startButton.disabled = false;
            }
        }

        startButton.addEventListener("click", async () => {
            let response = await fetch(`http://127.0.0.1:5000/start_mining?user_id=${userId}`);
            let data = await response.json();

            if (data.success) {
                alert("Mining started!");
                checkMining();
            } else {
                alert(data.message);
            }
        });

        checkMining();
    });
    </script>
</body>
</html>
